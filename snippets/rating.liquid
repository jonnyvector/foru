{%- comment -%}
  Priority order for rating data:
  1. Product metaobject with "Use Static Rating" = true
  2. Real review app data
  3. No reviews fallback
{%- endcomment -%}

{%- liquid
  assign rating_value = null
  assign review_count = null
  assign has_rating = false

  # Check for product-level static rating metaobject
  if product.metafields.custom.product_rating and product.metafields.custom.product_rating.use_review_data == true
    assign rating_value = product.metafields.custom.product_rating.rating
    assign review_count = product.metafields.custom.product_rating.review_count
    assign has_rating = true
  elsif reviews.rating.value != blank and reviews.rating_count != 0
    # Use real review app data
    assign rating_value = reviews.rating.value.rating
    assign review_count = reviews.rating_count
    assign has_rating = true
  endif

  assign percent = rating_value | times: 20
-%}

<!-- DEBUG: product_rating exists: {{ product.metafields.custom.product_rating }} -->
<!-- DEBUG: use_review_data: {{ product.metafields.custom.product_rating.use_review_data }} -->
<!-- DEBUG: rating: {{ product.metafields.custom.product_rating.rating }} -->
<!-- DEBUG: review_count: {{ product.metafields.custom.product_rating.review_count }} -->
<!-- DEBUG: has_rating: {{ has_rating }} -->

<div class="wt-rating{% if text_alignment %} wt-rating--{{ text_alignment }}{% endif %} {% if settings.animations and main_product %} scroll-trigger animate--slide-in {% endif %} {% if settings.disabled_animations_on_mobile %} disabled-on-mobile {% endif %}">
  {% render 'rating-stars', percent: percent %}

  <div class="wt-rating__counter">
    {% if has_rating %}
      ({{ review_count }}
      {{ 'accessibility.total_reviews' | t -}}
      )
    {% else %}
      ({{ 'no_reviews' | t -}}
      )
    {% endif %}
  </div>
</div>
