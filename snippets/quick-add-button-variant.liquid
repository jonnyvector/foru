{% comment %} Quick add button for variant context {% endcomment %}
{% if product.selling_plan_groups.size > 0 %}
  {% comment %} For products with selling plans, use quick-add to show selling plan selection {% endcomment %}
  <quick-add data-product-handle="{{ product.handle }}">
    {%- if card_variant.available -%}
      {% assign button_text = 'products.product.add_to_cart' | t %}
      {% assign button_disabled = false %}
    {%- else -%}
      {% assign button_text = 'products.product.sold_out' | t %}
      {% assign button_disabled = true %}
    {%- endif -%}

    {% render 'custom-button-loadable'
      , text: button_text
      , type: 'button'
      , style: 'secondary'
      , class: 'button--full-width'
      , aria_label: button_text
      , disabled: button_disabled
      , id: product.handle
      , name: 'commit'
      , data_product_url: product.url
      , align: 'center'
    %}
  </quick-add>
{% else %}
  {% comment %} For products without selling plans, direct add to cart {% endcomment %}
  <product-form class="wt-product__add-to-cart" data-hide-errors="{{ gift_card_recipient_feature_active }}">
    <div class="product-form__error-message-wrapper" role="alert" hidden>
      <span class="product-form__error-message"></span>
    </div>
    {%- form 'product',
      product,
      id: product_form_id,
      class: 'wt-product__add-to-cart_form form',
      novalidate: 'novalidate',
      data-type: 'add-to-cart-form'
    -%}
      <div class="wt-product__add-to-cart_form--wrapper">
        <input type="hidden" name="id" value="{{ card_variant.id }}">
        {% if card_variant.available %}
          {% assign button_text = 'products.product.add_to_cart' | t %}
          {% assign button_aria = 'products.product.add_to_cart' | t %}
          {% assign is_disabled = false %}
        {% else %}
          {% assign button_text = 'products.product.sold_out' | t %}
          {% assign button_aria = 'products.product.sold_out' | t %}
          {% assign is_disabled = true %}
        {% endif %}

        {% render 'custom-button-loadable',
          text: button_text,
          type: 'submit',
          style: 'secondary',
          aria_label: button_aria,
          class: 'button--full-width',
          id: section.id | append: '-variant-' | append: card_variant.id,
          disabled: is_disabled,
          align: 'center'
        %}
      </div>
    {%- endform -%}
  </product-form>
{% endif %}